---
Generated: 2025-12-23 12:00:00
Ticket Number: 15
---

# Infrastructure â€“ Database & Supabase Setup (Section 1.3)

- Type: Task
- Priority: High
- Story Points: 5
- Labels: infrastructure, database, supabase, migrations
- Git Branch: `feat/workbench-15-infrastructure-database-setup`

## Description

Setup the full database and Supabase infrastructure for Workbench, including Supabase project configuration, relational schema design, migrations, seed data, and repository integration, so that all core features can rely on a robust and consistent persistence layer.

## User Story

As a developer, I want a fully configured database and Supabase integration so that I can implement domain usecases and UI features without worrying about low-level persistence details.

## Acceptance Criteria

- [ ] **Supabase Project Setup**
  - [ ] Supabase project created in the correct organization
  - [ ] Environment variables (`NEXT_PUBLIC_SUPABASE_URL`, publishable key) configured and documented
  - [ ] Supabase dashboard configuration (auth, RLS, etc.) aligned with Workbench needs

- [ ] **Database Schema Design**
  - [ ] Relational schema designed for `Project`, `Ticket`, `Epic`, `Board`, and `Column` entities
  - [ ] ERD (even lightweight) documented in `docs/` or in a planning report
  - [ ] Naming conventions and relationships (FKs, cardinalities) aligned with domain model in section 2

- [ ] **Migration System**
  - [ ] A migration mechanism is selected (Supabase migrations/SQL files or CLI-based)
  - [ ] Initial migration creates all required tables and constraints
  - [ ] Migrations are idempotent and can be run from a clean environment

- [ ] **Seed Data**
  - [ ] Seed script or migration inserts a default project and a minimal set of columns/board configuration
  - [ ] Seed process is documented (how to run locally and in CI if needed)

- [ ] **Database Connection & Repositories**
  - [ ] Existing Supabase client singleton in `src/infrastructure/supabase/client.ts` is validated and adjusted if needed
  - [ ] Repository pattern boundaries clarified (ports in `core/ports`, implementations in `infrastructure/supabase`)
  - [ ] At least one example repository (e.g. `ProjectRepositorySupabase` or `TicketRepositorySupabase`) is implemented end-to-end against the schema

## Technical Considerations

- **Domain (core/domain)**
  - Ensure database schema matches the domain entities defined in section 2 (Project, Ticket, Epic, Board, Column)
  - Prefer Zod schemas in domain for validating external data mapped from Supabase

- **Usecases (core/usecases)**
  - Usecases should depend only on repository ports (interfaces), not on Supabase directly
  - At least one key usecase (e.g. `getProject` or `listTickets`) should be wired to the new repository as a reference

- **Infrastructure (infrastructure/supabase)**
  - Keep Supabase-specific logic (queries, filters, pagination) inside repository implementations and mappers
  - Implement clear error mapping from Supabase errors to domain-level error types
  - Ensure the Supabase client configuration remains centralized and reusable

- **Presentation (presentation/hooks & components)**
  - React Query hooks must call usecases, not Supabase directly
  - No direct Supabase calls from components; all data access should go through the infrastructure layer via ports/usecases

## Definition of Done

- [ ] Supabase project created and environment variables configured for local development
- [ ] Database schema and constraints implemented and applied via a repeatable migration process
- [ ] Seed data script/migration available and documented
- [ ] At least one repository implementation and one usecase successfully interact with the database
- [ ] Basic manual test performed (e.g. fetching seeded project/tickets through a usecase or React Query hook)
- [ ] Documentation in `docs/` or `report/planning/` updated to describe schema, migrations, and how to bootstrap a new environment

## Related Components

- Files (planned / impacted):
  - `src/core/domain/**` (entities and schemas)
  - `src/core/ports/**` (repository interfaces)
  - `src/core/usecases/**` (usecases wired to repositories)
  - `src/infrastructure/supabase/client.ts`
  - `src/infrastructure/supabase/**` (repository implementations, mappers)
  - `docs/plan.md` section **1.3 Infrastructure Setup**
  - `report/planning/plan-workbench-15-infrastructure-database-setup.md` (to be generated)

- Dependencies:
  - Supabase project & CLI
  - `@supabase/supabase-js`
  - Migration tooling (Supabase migrations or equivalent)
