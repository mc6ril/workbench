---
Generated: 2025-01-27 15:00:00
Ticket Number: 38
---

# Ticket Business Rules

**Type:** Task  
**Priority:** High  
**Story Points:** 5  
**Labels:** domain, business-rules, ticket, validation, core  
**Git Branch:** `feat/workbench-38-ticket-business-rules`

## Description

Implement Ticket business rules as pure domain functions. These rules enforce constraints like maximum one parent ticket, maximum one epic assignment, and status validation. Business rules are pure TypeScript functions in the domain layer.

## User Story

As a developer, I want Ticket business rules implemented so that ticket constraints are enforced at the domain level before data persistence.

## Acceptance Criteria

1. **Single Parent Constraint**
   - [ ] Function `validateTicketParent()` that ensures a ticket has at most one parent
   - [ ] Function validates that `parentId` is either `null` or a valid UUID
   - [ ] Function prevents circular references (ticket cannot be its own parent)
   - [ ] Function prevents multi-level nesting (parent's parent must be null)

2. **Single Epic Constraint**
   - [ ] Function `validateTicketEpic()` that ensures a ticket belongs to at most one epic
   - [ ] Function validates that `epicId` is either `null` or a valid UUID

3. **Status Validation**
   - [ ] Function `validateTicketStatus()` that validates ticket status
   - [ ] Status must be a non-empty string
   - [ ] Status must match a valid column status from the board (future: validate against board columns)

4. **Position Validation**
   - [ ] Function `validateTicketPosition()` that ensures position is non-negative integer
   - [ ] Position validation integrated with status validation

5. **Composite Validation**
   - [ ] Function `validateTicket()` that combines all ticket validations
   - [ ] Function accepts Ticket or CreateTicketInput
   - [ ] Returns validation result (success/error)

6. **Error Handling**
   - [ ] Domain errors defined for validation failures
   - [ ] Clear error messages for each validation failure
   - [ ] Errors are domain-specific (not infrastructure errors)

## Technical Considerations

- **Domain Layer**: Business rules in `core/domain/ticket.rules.ts` (pure TypeScript, no external dependencies)
- **Pure Functions**: All rules are pure functions without side effects
- **No Infrastructure**: Rules do not call repositories or external services
- **Type Safety**: All functions properly typed with TypeScript
- **Reusability**: Rules can be used by usecases before calling repositories
- **Error Types**: Use domain error types (not infrastructure errors)

## Definition of Done

- [ ] `validateTicketParent()` function implemented
- [ ] `validateTicketEpic()` function implemented
- [ ] `validateTicketStatus()` function implemented
- [ ] `validateTicketPosition()` function implemented
- [ ] `validateTicket()` composite function implemented
- [ ] Domain errors defined for validation failures
- [ ] All functions properly typed
- [ ] Unit tests written for all business rules
- [ ] No external dependencies in domain layer
- [ ] No TypeScript errors

## Related Components

- `core/domain/ticket.rules.ts` (new file)
- `core/domain/ticket.schema.ts` (uses Ticket types)
- `core/domain/repositoryError.ts` (reference for error patterns)
- Future: Ticket usecases (will use these rules)
- `__tests__/core/domain/ticket.rules.test.ts` (unit tests)
