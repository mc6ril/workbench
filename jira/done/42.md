---
Generated: 2026-01-08 10:00:00
Ticket Number: 42
---

## Title

Implement core ticket usecases for project board

## Type

Feature

## Priority

High

## Story Points

8

## Labels

- domain
- usecases
- ticket
- clean-architecture

## Git Branch

`feat/workbench-42-ticket-usecases`

## Description

Implement the first set of ticket-related usecases required to support backlog, board, and ticket management flows in the project, following Clean Architecture principles. These usecases will provide validated orchestration over the ticket repository to cover creation, update, deletion, listing, detail retrieval, movement, reordering, epic assignment, and subtask creation.

## User Story

As a project member, I want to manage tickets (create, update, delete, move, and organize them) so that I can maintain a clear and up-to-date project board.

## Scope

This ticket covers the design and implementation of all ticket-related usecases mentioned in the planning document section 2.3 for the "Ticket" sub area:

- Create Ticket Use Case
- Update Ticket Use Case
- Delete Ticket Use Case
- List Tickets Use Case
- Get Ticket Detail Use Case
- Move Ticket Use Case
- Reorder Ticket Use Case
- Assign Ticket to Epic Use Case
- Create Subtask Use Case

## Acceptance Criteria

1. **Create Ticket Use Case**
   - Given valid ticket input (respecting domain schema and validation rules), `createTicket` returns a `Ticket` domain object created through the `TicketRepository`.
   - Given invalid input, `createTicket` rejects with a domain validation error and does not call the repository.

2. **Update Ticket Use Case**
   - `updateTicket` allows updating ticket title, description, and other mutable fields while preserving non-editable fields.
   - On invalid changes (e.g., violating domain rules), the usecase fails with a domain error before calling the repository.

3. **Delete Ticket Use Case**
   - `deleteTicket` deletes a ticket by id using the repository.
   - If cascade or subtask constraints apply, the usecase ensures domain rules are enforced (e.g., no orphaned subtasks) and returns a clear error when deletion is not allowed.

4. **List Tickets Use Case**
   - `listTickets` supports optional filtering (e.g., by status, assignee, epic) and sorting (e.g., by position or creation date).
   - When filters or sorting parameters are invalid, the usecase fails fast with a domain validation error.

5. **Get Ticket Detail Use Case**
   - `getTicketDetail` returns a complete ticket representation (including relationships needed by the board and detail views, such as epic, subtasks, and status).
   - If the ticket does not exist, the usecase returns a typed "not found" error mapped at domain level.

6. **Move Ticket and Reorder Ticket Use Cases**
   - `moveTicket` updates both the ticket status/column and its position within the board, ensuring position invariants are respected.
   - `reorderTicket` supports reordering tickets within a column, and the positions of affected tickets are updated consistently through the repository.

7. **Assign Ticket to Epic and Create Subtask Use Cases**
   - `assignTicketToEpic` validates that both ticket and epic exist and that the assignment respects domain constraints (e.g., project consistency).
   - `createSubtask` enforces single-level nesting (no subtask of subtask) and returns a domain error if the rule is violated.

## Technical Considerations

- **Domain**
  - Reuse existing ticket domain types and schemas (`ticket.schema.ts`) for validation.
  - Add or refine domain rules for ticket movement, ordering, subtask nesting, and epic assignment if missing.
- **Usecases**
  - Implement the usecases under `core/usecases/ticket/` (e.g., `createTicket`, `updateTicket`, `deleteTicket`, `listTickets`, `getTicketDetail`, `moveTicket`, `reorderTicket`, `assignTicketToEpic`, `createSubtask`).
  - Each usecase must:
    - Accept typed input (derived from Zod schemas).
    - Validate input using Zod at the usecase boundary.
    - Depend only on ticket-related ports from `core/ports/ticketRepository.ts` and other relevant ports (epic/board) when necessary.
    - Return domain models or typed domain errors.
- **Ports**
  - Ensure `TicketRepository` contains the methods required by these usecases (create, update, delete, list, getById, move, reorder, assignEpic, manageSubtasks); extend the port if strictly necessary while keeping responsibilities cohesive.
- **Infrastructure**
  - No direct infrastructure changes in this ticket; usecases must be fully testable against mocked repositories.
  - Actual Supabase repository adaptations will be handled in a separate infrastructure-focused ticket.
- **Presentation**
  - No UI changes required in this ticket; React Query hooks and components will integrate these usecases in separate tickets.

## Definition of Done

- Usecases implemented in `core/usecases/ticket/` for all ticket-related operations listed in the Scope.
- All new or updated usecases:
  - Use Zod schemas from the domain for input validation.
  - Depend exclusively on ports defined in `core/ports/`.
  - Return domain types or typed domain errors.
- Unit tests:
  - New Jest tests created under `__tests__/core/usecases/ticket/` covering success paths, error paths, and edge cases for each usecase.
  - All repository calls are mocked via existing mocks in `__mocks__/core/ports/`.
  - Tests run successfully with `npm test` / `yarn test` and respect project testing conventions.
- Documentation:
  - Short JSDoc added for each usecase explaining its responsibility and main domain rules.
  - Planning document updated to mark the corresponding "Ticket" usecases as "In Progress" or "Done" once merged (optional but recommended).
- Code quality:
  - No ESLint or TypeScript errors.
  - Imports follow project conventions (absolute `@/` paths, correct order).
  - No business logic in presentation or infrastructure layers; all orchestration remains in usecases.
