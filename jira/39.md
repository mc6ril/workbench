---
Generated: 2025-01-27 15:00:00
Ticket Number: 39
---

# Epic Business Rules

**Type:** Task  
**Priority:** High  
**Story Points:** 3  
**Labels:** domain, business-rules, epic, validation, core  
**Git Branch:** `feat/workbench-39-epic-business-rules`

## Description

Implement Epic business rules as pure domain functions. These rules enforce constraints for epic-ticket relationships, such as ensuring tickets can only be assigned to one epic and validating epic data integrity.

## User Story

As a developer, I want Epic business rules implemented so that epic constraints are enforced at the domain level before data persistence.

## Acceptance Criteria

1. **Epic-Ticket Assignment Rules**
   - [ ] Function `validateEpicTicketAssignment()` that validates ticket assignment to epic
   - [ ] Function ensures ticket belongs to same project as epic
   - [ ] Function prevents duplicate ticket assignments (ticket already assigned to another epic)
   - [ ] Function validates epic exists (when epicId provided)

2. **Epic Data Validation**
   - [ ] Function `validateEpic()` that validates epic data integrity
   - [ ] Epic name must be non-empty string
   - [ ] Epic must belong to a valid project
   - [ ] Description is optional but must be string if provided

3. **Epic Progress Calculation Rules**
   - [ ] Function `calculateEpicProgress()` that calculates epic completion percentage
   - [ ] Function accepts list of tickets assigned to epic
   - [ ] Function calculates progress based on ticket statuses
   - [ ] Progress is a number between 0 and 100
   - [ ] Pure function (no side effects, no external dependencies)

4. **Composite Validation**
   - [ ] Function `validateEpicWithTickets()` that validates epic and its ticket assignments
   - [ ] Combines epic validation and ticket assignment validation
   - [ ] Returns validation result (success/error)

5. **Error Handling**
   - [ ] Domain errors defined for validation failures
   - [ ] Clear error messages for each validation failure
   - [ ] Errors are domain-specific (not infrastructure errors)

## Technical Considerations

- **Domain Layer**: Business rules in `core/domain/epic.rules.ts` (pure TypeScript, no external dependencies)
- **Pure Functions**: All rules are pure functions without side effects
- **No Infrastructure**: Rules do not call repositories or external services
- **Type Safety**: All functions properly typed with TypeScript
- **Reusability**: Rules can be used by usecases before calling repositories
- **Progress Calculation**: Pure calculation function, does not fetch data (data passed as parameter)

## Definition of Done

- [ ] `validateEpicTicketAssignment()` function implemented
- [ ] `validateEpic()` function implemented
- [ ] `calculateEpicProgress()` function implemented
- [ ] `validateEpicWithTickets()` composite function implemented
- [ ] Domain errors defined for validation failures
- [ ] All functions properly typed
- [ ] Unit tests written for all business rules
- [ ] No external dependencies in domain layer
- [ ] No TypeScript errors

## Related Components

- `core/domain/epic.rules.ts` (new file)
- `core/domain/epic.schema.ts` (uses Epic types)
- `core/domain/ticket.schema.ts` (uses Ticket types for assignments)
- `core/domain/repositoryError.ts` (reference for error patterns)
- Future: Epic usecases (will use these rules)
- `__tests__/core/domain/epic.rules.test.ts` (unit tests)
